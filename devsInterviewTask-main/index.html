<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="style.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    
    <title>Evulpo VD</title>
</head>
<body>
    <div class="progress">
        <div class="progress-bar" id="myBar" role="progressbar" style="width: 33%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Question 1 of 3</div>
    </div>
    <div class="firs-screen" id="questionScreen">
        <p class="question" id="question"></p>
        <div class="container-fluid">
            <div class="row">
                <div class="col-md">
                    <div class="option" id="option1" onclick="toggleChoice(0,this.id)"></div>
                </div>
                <div class="col-md">
                    <div class="option" id="option2" onclick="toggleChoice(1,this.id)"></div>
                </div>
                <div class="col-md" id="div3">
                    <div class="option" id="option3" onclick="toggleChoice(2,this.id)"></div>
                </div>
                <div class="d-none col-md" id="lastDiv">
                    <div class="option" id="option4" onclick="toggleChoice(3,this.id)"></div>
                </div>
            </div>
            <button class="standard-btn" id="evaluate" onclick="myEvaluation()">Evaluate!</button>
        </div>
        <div class="evaluation-message-right" id="evaluation-message-right" >Awesome! :)</div>
        <div class="evaluation-message-wrong" id="evaluation-message-wrong" >Keep trying! :(</div>
    
        <button class="standard-btn" id="next" onclick="goNext()" style="display: none;">Next</button>
    </div>

    <div class="d-none second-screen" id="finalScreen">
        <div class="container">
            <div class="img-container">
                <img src="\images\fox_evulpo.jpg" alt="EvulpoFox">
            </div>
            <div class="show-score">
                <h1>Thanks for learning with Evulpo</h1>
                <h2 id="score-label">Your score is:</h2>
                <button class="standard-btn" onclick="document.location.reload(true)">Start again</button>
            </div>
        </div>

    </div>

    <script>
                // this is a basic connection schema to the corresponding data for the table provided.
                // this API KEY will expire after January 2022
                // Written by GSoosalu & ndr3svt
                const API_KEY = 'AIzaSyCfuQLHd0Aha7KuNvHK0p6V6R_0kKmsRX4';
                const DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];
                const SCOPES = "https://www.googleapis.com/auth/spreadsheets.readonly";
                let exerciseIndex;
                let exerciseData;
                let options;
                let states = [];
                let correct_answer_index;
                let chosen_answer_index;
                let arrData;
                let selectindx;
                let curArray;
                let rightindx;
                let score = 0;
                let finalScore = 0;
                let selected_id;
                let clicked = false;
                let nextCounter = 0;

                function handleClientLoad() {
                    gapi.load('client', initClient);
                }

                function initClient() {
                    gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: DISCOVERY_DOCS
                    }).then(function () {
                    getExerciseData();
                    }, function(error) {
                    console.log(JSON.stringify(error, null, 2));
                    });
                }

                function getExerciseData() {
                    gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: '1hzA42BEzt2lPvOAePP6RLLRZKggbg0RWuxSaEwd5xLc',
                    range: 'Learning!A1:F10',
                    }).then(function(response) {
                        response.result.values.shift(); //eliminates first element
                        arrData = response.result.values;
                        getAnswers();

                    }, function(response) {
                        console.log('Error: ' + response.result.error.message);
                    });
                }

                function getAnswers(){
                   


                    let rand = Math.floor(Math.random()*arrData.length);    //selects a random element from the array
                    let rValue = arrData[rand];
                    curArray = rValue
                    rightindx = curArray[4];  //saves index of correct answer
                    score = rValue[5]; // save the score of that question
                    document.getElementById("question").innerHTML = rValue[2];  //inserts question
                    let arrAnswers = rValue[3];
                    let finalAnswers = arrAnswers.split(";")  //splits the array of answers
                    document.getElementById("option1").innerHTML = finalAnswers[0];
                    document.getElementById("option2").innerHTML = finalAnswers[1];
                        
                    // option 3 and option 4 are special cases
                    let div3 = document.getElementById("div3");
                    let lastDiv = document.getElementById("lastDiv");
                    let op_four = document.getElementById("option4");

                    if (finalAnswers[2] === undefined || finalAnswers[2] === null ) {
                        div3.style.display = "none";
                    }else {                       
                        document.getElementById("option3").innerHTML = finalAnswers[2];
                        div3.style.display = "block";
                    }

                    if (finalAnswers.length > 3){
                        lastDiv.classList.remove("d-none");
                        op_four.innerHTML = finalAnswers[3];
                    } else {
                        lastDiv.classList.add("d-none");
                    }
                }

              
                function toggleChoice(index,id){
                    selected_id = id;
                    selectindx = index; 
                   
                    if (document.getElementsByClassName("option-selected").length > 0 ){
                        document.getElementsByClassName("option-selected")[0].className = "option";
                        document.getElementById(selected_id).className = "option-selected";
                    }
                    
                }

                function myEvaluation(){
                    let right_msg = document.getElementById("evaluation-message-right");
                    let wrong_msg = document.getElementById("evaluation-message-wrong");
                    let next_btn = document.getElementById("next");
                    let evaluate_btn = document.getElementById("evaluate");


                    if (selectindx == rightindx) {
                        right_msg.style.display = next_btn.style.display = "block";
                        wrong_msg.style.display = evaluate_btn.style.display = "none";
                        document.getElementById(selected_id).className = "option-success";
                        finalScore = finalScore + score;

                    } else {
                        wrong_msg.style.display = next_btn.style.display = "block";
                        evaluate_btn.style.display = right_msg.style.display = "none";
                        document.getElementById(selected_id).className = "option-failure";
                        finalScore = finalScore + 0;
                    }
                } 

               
                function goNext(){
                    let elem = document.getElementById("myBar");
                    nextCounter++;
                    getAnswers();
                    document.getElementById("next").style.display = "none";
                    document.getElementById("evaluate").style.display = "block";
                    document.getElementById("score-label").innerHTML = "Your score is: " + finalScore; 

                    if(document.getElementsByClassName("option-failure").length > 0){
                        document.getElementsByClassName("option-failure")[0].className = "option"; 
                        document.getElementById("evaluation-message-wrong").style.display = "none"; 
                    }

                    if (document.getElementsByClassName("option-success").length > 0){
                        document.getElementsByClassName("option-success")[0].className = "option";
                        document.getElementById("evaluation-message-right").style.display = "none";
                    }

                    switch(nextCounter) {
                    case 1:
                        setBarWidth(66,elem);
                        elem.innerHTML = "Question 2 of 3"
                        break;
                    case 2:
                        setBarWidth(99,elem);
                        elem.innerHTML = "Question 3 of 3"
                        break;
                    case 3:
                        setBarWidth(100,elem);
                        elem.innerHTML = "Completed!";
                        f_screen = document.getElementById("finalScreen");
                        f_screen.classList.remove("d-none");
                        document.getElementById("questionScreen").style.display = "none";
                        break; 
                    }
                }


                function setBarWidth(width,elem) {
                    elem.style.width = width + "%";
                    elem.innerHTML = width  + "%";
                }

              

    </script>

    <script async defer src="https://apis.google.com/js/api.js"
        onload="this.onload=function(){};handleClientLoad()"
        onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
    



</body>
</html>